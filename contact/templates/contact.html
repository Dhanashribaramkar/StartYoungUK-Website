{% extends 'base.html' %}
{% load static %}
{% block content %}

<script>
  document.getElementById("nav-contact").classList.add("active");
</script>

<style>
  .opportunity-cards {
    margin-bottom: 5%;
  }
</style>

<div class="block-31" style="position: relative;">
    <div class="owl-carousel loop-block-31 homepage-nav">
      <div class="block-30 block-30-sm item" style="background-image: url('/static/images/join-us.jpg');" data-stellar-background-ratio="0.5">
        <div class="container">
          <div class="row align-items-center justify-content-center">
            <div class="col-md-7 text-center">
              <h2 class="heading">Join & Contact Us</h2>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>

  <div class="site-section">
    <div class="container opportunity-cards">
      <div class="col-md-12 block-11">
        <h2 class="heading">Explore our Career Opportunities:</h2>
        <div class="nonloop-block-11 owl-carousel">
        {% for opportunity in opportunities %}
          {% if not opportunity.position_filled and today < opportunity.end_date %}
            <div class="card fundraise-item">
                <div class="card-body campaign-card">
                    <div>
                        <h3 class="card-title"><a href="#">{{ opportunity.title }}</a></h3>
                        <p class="card-text">{{ opportunity.description }}</p>
                    </div>
                    <div>
                        <span class="donation-time mb-3 d-block">Deadline: {{ opportunity.end_date }}</span>
                        <span class="donation-time mb-3 d-block">Duration: {{ opportunity.duration }}</span>
                        <span class="donation-time mb-3 d-block">Salary: {{ opportunity.salary }} GBP</span>
                        <div class="form-group">
                            <button class="donate-btn login-btn btn btn-primary" type="button" onclick="location.href='{{ opportunity.form_url }}'">Register</button>
                        </div>
                    </div>
                </div>
            </div>
          {% endif %}
        {% endfor %}

        </div>
    </div>
    </div>

    <div class="container">
      <h2 class="heading">Contact Us:</h2>
      <div class="row block-9">
        <div class="col-md-6 pr-md-5">
          <form id="ajax-contact" name="google-sheet" method="POST">
            <div class="form-group">
              <input type="text" name="Name" id="Name" class="form-control px-3 py-3" placeholder="Your Name" required>
            </div>
            <div class="form-group">
              <input type="email" name="Email" id="Email" class="form-control px-3 py-3" placeholder="Your Email"required>
            </div>
            <div class="form-group">
              <input type="text" name="Subject" id="Subject" class="form-control px-3 py-3" placeholder="Subject" required>
            </div>
            <div class="form-group">
              <textarea name="Message" id="Message" cols="30" rows="7" class="form-control px-3 py-3" placeholder="Message..." required></textarea>
            </div>
            <div class="form-group">
              <button id="submit" name="Submit" type="submit" class="btn btn-primary py-3 px-5">Send Message</button>
            </div>
            <div id="snackbar"></div>
          </form>
        
        </div>

        <script>
          function showToast(message, color) {
            // Get the snackbar DIV
            var x = document.getElementById("snackbar");
            x.innerHTML = message;
            x.style.backgroundColor = color;

            // Add the "show" class to DIV
            x.className = "show";

            // After 3 seconds, remove the show class from DIV
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
          }
        </script>
        <script>
          const scriptURL = "https://script.google.com/macros/s/AKfycbyxIzRJZHPOhkWFX68jF_ngKiV1FbVwdbBlvpIJxiQ-jF7a1vDHTDZhWHUYua4-rfI88g/exec"
          const form = document.forms['google-sheet']
          
          form.addEventListener('submit', e => {
            e.preventDefault()
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => showToast("Message sent successfully!", "green"))
            .catch(error => showToast("There was an error sending your message, please try again!", "red"))
          })
         </script>

        <div class="col-md-6" id="map"></div>
      </div>
    </div>
  </div>

 
  {% endblock %}
